[Definition]
actionstart =
actionstop =
actioncheck =

actionban = /bin/bash -lc 'SERVER_IP="$(hostname -I 2>/dev/null | awk "{print \$1}")"; \
  [ -z "$SERVER_IP" ] && SERVER_IP="$(hostname -i 2>/dev/null | awk "{print \$1}")"; \
  MESSAGE="ðŸš« Fail2Ban SSH: Banned IP <ip> after <failures> failures on ${SERVER_IP}"; \
  /usr/bin/curl -fsS -X POST "https://api.telegram.org/bot<token>/sendMessage" \
    -d "chat_id=<chat_id>" \
    -d "message_thread_id=<message_thread_id>" \
    -d "text=${MESSAGE}" >/dev/null 2>&1 || true; \
  echo "[$(date -Is)] BAN <ip> - <failures> failures" >> /var/log/fail2ban-telegram.log'

actionunban = /bin/bash -lc 'SERVER_IP="$(hostname -I 2>/dev/null | awk "{print \$1}")"; \
  [ -z "$SERVER_IP" ] && SERVER_IP="$(hostname -i 2>/dev/null | awk "{print \$1}")"; \
  MESSAGE="âœ… Fail2Ban SSH: Unbanned IP <ip> on ${SERVER_IP}"; \
  /usr/bin/curl -fsS -X POST "https://api.telegram.org/bot<token>/sendMessage" \
    -d "chat_id=<chat_id>" \
    -d "message_thread_id=<message_thread_id>" \
    -d "text=${MESSAGE}" >/dev/null 2>&1 || true; \
  echo "[$(date -Is)] UNBAN <ip>" >> /var/log/fail2ban-telegram.log'


[Init]
token = token
chat_id = chat_id
message_thread_id = message_thread_id
