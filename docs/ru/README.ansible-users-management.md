# Users Management

Этот модуль управляет пользователями на серверах с помощью Ansible.

Он поддерживает:
- добавление пользователей
- удаление пользователей
- назначение привилегий sudo
- управление доступом по SSH

Все поведение контролируется с помощью переменных в 
[secret.example.yml](../../src/ansible-users-management/vars/secret.example.yml).


---

## Как это работает

Playbook считывает переменные из секретного файла и применяет состояние пользователя
к определенным группам хостов.

Существует только два возможных состояния:
- пользователь должен существовать на серверах
- пользователь должен отсутствовать на серверах

Никаких изменений вручную внутри playbook не требуются.

---

## Переменные

Все переменные определены в: [secret.example.yml](../../src/ansible-users-management/vars/secret.example.yml)

### Пример:
```yaml
username: deploy

present_servers:
  - prod_servers
  - staging_servers

absent_servers:
  - old_servers
```


### Описание переменных

| Variable             | Description                                                        |
|----------------------|--------------------------------------------------------------------|
| `username`           | Имя пользователя                                                   |
| `present_servers`    | Группы хостов, на которых пользователь ** должен присутствовать ** |
| `absent_servers`     | Группы хостов, на которых пользователь **должен быть удален**      |


## Правила поведения
Если сервер находится в системе `present_servers`:

- пользователь создан
- Доступ по SSH разрешен
- права sudo предоставлены (если настроены)

Если сервер находится в группе хостов `absent_servers`, удаляется пользователь и его домашний каталог.
Если сервер не указан ни в одном из списков, изменения не применяются

## Запуск
```bash
make users_management.yml
```

## Важные замечания
- Не редактируйте плейбуки для управления пользователями
- Все изменения должны проходить через переменные
- Один запуск playbook = единственный источник правды
- Возможность многократного повторного запуска (идемпотентность)